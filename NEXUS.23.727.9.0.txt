@0
   MOV UP DOWN

@1
## T31 EMU

@2
   MOV RIGHT ACC
   MOV ACC RIGHT
   MOV ACC RIGHT

@3
S:  MOV RIGHT LEFT
    SUB LEFT
    JLZ L2
L1: JEZ E
    SUB 1
    MOV UP DOWN
    JMP L1
L2: JEZ E
    ADD 1
    MOV DOWN UP
    JMP L2

E:  MOV LEFT ACC
    MOV -1 RIGHT

@4
S: MOV UP ACC
   JNZ READ

WRITE:
   MOV UP LEFT
   MOV LEFT NIL
   MOV 1 DOWN #JRO
   MOV UP DOWN
   JMP S

READ:
   MOV UP LEFT
   MOV LEFT NIL
   MOV 4 DOWN #JRO

@5
# LEFT NODE IS
# THE INSTRUCTION
# DECODER.

# LEFT AGAIN WE
# HAVE THE SEEKER
# WHICH MOVES THE
# NUMBERS UNTIL
# THE NUMBER
# AT THE DESIRED
# INDEX IS AT THE
# TOP OF THE
# BOTTOM STACK.

@6
# INIT STACK
# WITH ALL ZEROS

   MOV 8 ACC
L: MOV 0 RIGHT
   SUB 1
   JNZ L
   JRO 0 # HALT

@7
J: JRO UP

WRITE:
   MOV LEFT NIL
   MOV UP LEFT
   JMP J

READ:
   MOV LEFT ACC
   MOV ACC DOWN
   MOV ACC LEFT

@8
# BUG:

# SOMETIMES FAILES
# THE RANDOM TEST.
# PROBABLY BECAUSE
# THE STACK IS NOT
# FINISHED INIT-
# IALISATING.